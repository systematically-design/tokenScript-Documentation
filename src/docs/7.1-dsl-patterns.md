# 7.1 DSL Patterns

Common patterns and idioms for working with TokenScript DSL. These examples demonstrate how to combine multiple features for powerful design system workflows.

## Responsive Spacing with Advanced Selectors

Combine iteration, step arithmetic, and collection access for responsive patterns:

```tokenscript
spacing
  sp01 = 8
  sp02 = 12
  sp03 = 16
  sp04 = 20
  sp05 = 24
  sp06 = 32
  sp07 = 40

responsive
  /matrix
    [mobile, tablet, desktop] as breakpoint
      // Base spacing increases with breakpoint
      base = $spacing[index + 1]
      
      // Related spacing based on base
      small = $...base.scope[step - 1]
      large = $...base.scope[step + 2]
      double = $...base.scope[step * 2]
      
      // With rounding for fractional steps
      half = $...base.scope[step / 2, down]
```

**Result:**
```
mobile:  base=12(sp02), small=8(sp01),  large=20(sp04), double=24(sp05), half=8(sp01)
tablet:  base=16(sp03), small=12(sp02), large=24(sp05), double=32(sp06), half=12(sp02)
desktop: base=20(sp04), small=16(sp03), large=32(sp06), double=40(sp07), half=16(sp03)
```

## Typography Scale with calc()

Use calc() and inheritance for computed typography values:

```tokenscript
fontSizes
  /numberScale : modular
    base = 16
    ratio = 1.25
    steps = [xs, sm, md, lg, xl]

lineHeights
  /inherit($fontSizes)
  /transform(value * 1.5)
  /roundTo(4)

custom
  // Computed font size
  special = calc($fontSizes.md * 1.15).roundTo(1)
  
  // Find closest match
  dynamic = calc(23).reference(fontSizes, nearest)
```

## Dynamic Calculations with Method Chaining

Chain multiple operations for complex calculations:

```tokenscript
base = 100
multiplier = 1.618

derived
  // Simple calc
  simple = calc($base / 3)
  
  // With rounding
  rounded = calc($base / 3).roundTo(5, up)
  
  // With reference lookup
  matched = calc($base * $multiplier).reference(spacing, nearest)
  
  // Full chain
  complex = calc($base * $multiplier).roundTo(8, up).reference(spacing, up)
```

## Multi-Dimensional Token Systems

Combine iteration with conditionals for complex systems:

```tokenscript
/matrix
  [mobile, tablet, desktop] as device
  [light, dark] as theme
    /if {device} == "mobile" and {theme} == "dark"
      fontSize = 14
      padding = 8
    /else if {device} in ["tablet", "desktop"]
      fontSize = 16
      padding = 16
    /else
      fontSize = 15
      padding = 12
```

## Progressive Enhancement Pattern

Use selective transforms to progressively enhance values:

```tokenscript
baseScale
  /numberScale : linear
    base = 8
    increment = 4
    steps = [xs, sm, md, lg, xl]

enhancedScale
  /inherit($baseScale)
  /transform(value * 1.2, [md, lg, xl])  // Enhance larger sizes
  /roundTo(4)
```

## Scale-Based Navigation

Use step arithmetic to navigate scales based on references:

```tokenscript
spacing
  /numberScale : linear
    base = 8
    increment = 4
    steps = [sp{01..10}]

components
  /forEach [card, modal, drawer] as component
    basePadding = $spacing[index + 2]
    tightPadding = $...basePadding.scope[step - 1]
    loosePadding = $...basePadding.scope[step + 2]
```

## Conditional Token Generation

Combine iteration with conditionals for dynamic systems:

```tokenscript
/forEach [xs, sm, md, lg, xl] as size
  /if {size} in ["xs", "sm"]
    category = "compact"
    padding = 8
  /else if {size} not in ["xs", "sm", "md"]
    category = "spacious"
    padding = 24
  /else
    category = "normal"
    padding = 16
```

## Next Steps

- Review [Troubleshooting](./7.2-troubleshooting.md) for common issues
- Check [FAQ](./7.3-faq.md) for answers to frequent questions
- Explore other documentation sections for more examples

