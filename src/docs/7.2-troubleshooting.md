# 7.2 Troubleshooting

Common issues and solutions when working with TokenScript DSL.

## Syntax Errors

### "Unexpected token" or "Parse error"

**Problem:** Invalid syntax in your DSL file.

**Solution:** Check for:
- Missing `=` in assignments
- Incorrect indentation
- Unclosed brackets or quotes
- Invalid characters

```tokenscript
// ❌ Wrong
spacing = 8
color = #ff0000  // Missing space or invalid format

// ✅ Correct
spacing = 8
color = #ff0000
```

### "Invalid indentation"

**Problem:** Inconsistent indentation.

**Solution:** Use consistent indentation (spaces or tabs, but not both):

```tokenscript
// ❌ Wrong - mixed indentation
colors
    primary = #3B82F6
  secondary = #8B5CF6

// ✅ Correct - consistent indentation
colors
  primary = #3B82F6
  secondary = #8B5CF6
```

## Reference Errors

### "Reference not found"

**Problem:** Referencing a token that doesn't exist.

**Solution:** Check:
- Token name spelling
- Token path (use dots for nested tokens)
- Token is defined before use

```tokenscript
// ❌ Wrong - referencing before definition
spacing = $baseUnit
baseUnit = 8

// ✅ Correct - define first
baseUnit = 8
spacing = $baseUnit
```

### "Circular reference detected"

**Problem:** Token references itself or creates a loop.

**Solution:** Break the circular reference:

```tokenscript
// ❌ Wrong - circular reference
a = $b
b = $a

// ✅ Correct - use direct values
a = 8
b = $a * 2
```

## Scale Errors

### "Invalid scale parameters"

**Problem:** Missing required parameters or invalid values.

**Solution:** Ensure:
- `base` is always provided
- For linear: provide `increment` or `peak`
- For modular: provide `ratio` or `peak`
- `steps` is provided

```tokenscript
// ❌ Wrong - missing increment
spacing
  /numberScale : linear
    base = 8
    steps = ["xs", "sm", "md"]

// ✅ Correct
spacing
  /numberScale : linear
    base = 8
    increment = 4
    steps = ["xs", "sm", "md"]
```

### "Steps must be positive"

**Problem:** Invalid steps value.

**Solution:** Use:
- Positive number
- Array of strings
- Comma-separated string

```tokenscript
// ❌ Wrong
steps = -5
steps = []

// ✅ Correct
steps = 5
steps = ["xs", "sm", "md"]
steps = "xs, sm, md"
```

## Color Errors

### "Invalid color format"

**Problem:** Color value doesn't match supported formats.

**Solution:** Use supported formats:
- Hex: `#ff0000`, `#f00`, `#ff0000ff`
- RGB: `rgb(255, 0, 0)`
- HSL: `hsl(0, 100%, 50%)`
- Named: `blue`, `red`, etc.

```tokenscript
// ❌ Wrong
color = ff0000  // Missing #
color = rgb(255,0,0)  // Spaces required

// ✅ Correct
color = #ff0000
color = rgb(255, 0, 0)
```

## Pipeline Errors

### "Invalid pipeline operation"

**Problem:** Unknown or malformed pipeline operation.

**Solution:** Use supported operations:
- `/roundTo(unit)`
- `/transform(expression)`

```tokenscript
// ❌ Wrong
/roundTo()  // Missing unit
/transform()  // Missing expression

// ✅ Correct
/roundTo(4)
/transform(each * 2)
```

### "Transform expression error"

**Problem:** Invalid expression in transform.

**Solution:** Check:
- Expression syntax
- Available variables (`each`, `value`, `index`)
- Mathematical operators

```tokenscript
// ❌ Wrong
/transform(each * )  // Incomplete expression
/transform(value +)  // Missing operand

// ✅ Correct
/transform(each * 2)
/transform(value + 4)
```

## Type Errors

### "Invalid token type"

**Problem:** Using unsupported type annotation.

**Solution:** Use supported types:
- `color`
- `spacing`
- `typography`
- `number`
- `string`
- `boolean`

```tokenscript
// ❌ Wrong
token:invalidType = value

// ✅ Correct
token:color = #ff0000
token:spacing = 16
```

## Common Issues

### Values not generating from scale

**Problem:** Scale defined but tokens not created.

**Solution:** Check:
- Scale syntax is correct
- Steps are defined
- Scale is properly indented

```tokenscript
// ❌ Wrong - scale not properly formatted
spacing /numberScale : linear base = 8

// ✅ Correct
spacing
  /numberScale : linear
    base = 8
    increment = 4
    steps = ["xs", "sm", "md"]
```

### References not resolving

**Problem:** Token references show as `$tokenName` instead of value.

**Solution:** Ensure:
- Referenced token exists
- Reference path is correct
- No circular dependencies

```tokenscript
// Check reference path
colors
  primary = #3B82F6

// ✅ Correct reference
buttonColor = $colors.primary

// ❌ Wrong reference
buttonColor = $color.primary  // Missing 's'
```

### Composite token validation errors

**Problem:** Composite token missing required properties.

**Solution:** Ensure all required properties are provided:

```tokenscript
// ❌ Wrong - missing required properties
heading:typography
  fontSize = 24
  // Missing lineHeight, fontWeight, fontFamily

// ✅ Correct - all required properties
heading:typography
  fontSize = 24
  lineHeight = 1.5
  fontWeight = 700
  fontFamily = "Inter"
```

## Getting Help

If you're still stuck:

1. **Check the syntax** - Review [Tokens & Values](./2.1-tokens-and-values.md) and [Expressions](./2.3-expressions.md)
3. **Validate your tokens** - Use the API to check for errors
4. **Check error messages** - They often point to the exact issue

## Debugging Tips

### Enable verbose logging

When using the API, check error responses for detailed messages.

### Test incrementally

Start with simple tokens and build up:

```tokenscript
// Start simple
test = 8

// Add complexity gradually
spacing = $test
spacing
  /numberScale : linear
    base = $test
    increment = 4
    steps = ["xs", "sm"]
```

### Validate syntax

Use the API to validate your tokens before using them in production.

## Next Steps

- Review [Tokens & Values](./2.1-tokens-and-values.md), [References](./2.2-references.md), and [Expressions](./2.3-expressions.md)
- See [Best Practices](./3.2-best-practices.md) for guidelines

